<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–ø–∏—Å—å | SBRemonts</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #667eea; padding: 20px; }
        .container { max-width: 500px; margin: 0 auto; background: white; border-radius: 20px; overflow: hidden; }
        .header { background: #4361ee; color: white; padding: 30px 20px; text-align: center; }
        .back-btn { position: absolute; left: 20px; top: 20px; color: white; font-size: 20px; cursor: pointer; }
        .form-container { padding: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-input, .form-select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        .time-slots { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
        .time-btn { padding: 10px 15px; background: #f0f0f0; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; }
        .time-btn.selected { background: #4361ee; color: white; border-color: #4361ee; }
        .submit-btn { background: #4361ee; color: white; border: none; padding: 15px; border-radius: 10px; font-size: 18px; width: 100%; cursor: pointer; margin-top: 20px; }
        .submit-btn:disabled { background: #ccc; cursor: not-allowed; }
        .fa-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="back-btn" onclick="window.location.href='index.html'">
                <i class="fas fa-arrow-left"></i>
            </div>
            <h1>–ó–∞–ø–∏—Å—å –Ω–∞ —É—Å–ª—É–≥—É</h1>
            <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –Ω–∏–∂–µ</p>
        </header>

        <div class="form-container">
            <div class="form-group">
                <label class="form-label">–£—Å–ª—É–≥–∞:</label>
                <select class="form-select" id="service">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É</option>
                    <option value="–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞">–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</option>
                    <option value="–ó–∞–º–µ–Ω–∞ –º–∞—Å–ª–∞">–ó–∞–º–µ–Ω–∞ –º–∞—Å–ª–∞</option>
                    <option value="–¢–æ—Ä–º–æ–∑–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞">–¢–æ—Ä–º–æ–∑–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</option>
                    <option value="–ü–æ–¥–≤–µ—Å–∫–∞">–ü–æ–¥–≤–µ—Å–∫–∞</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">–î–∞—Ç–∞:</label>
                <input type="date" class="form-input" id="date">
            </div>

            <div class="form-group">
                <label class="form-label">–í—Ä–µ–º—è:</label>
                <div class="time-slots" id="timeSlots">
                    <div class="time-btn" data-time="09:00">09:00</div>
                    <div class="time-btn" data-time="10:00">10:00</div>
                    <div class="time-btn" data-time="11:00">11:00</div>
                    <div class="time-btn" data-time="12:00">12:00</div>
                    <div class="time-btn" data-time="13:00">13:00</div>
                    <div class="time-btn" data-time="14:00">14:00</div>
                    <div class="time-btn" data-time="15:00">15:00</div>
                    <div class="time-btn" data-time="16:00">16:00</div>
                    <div class="time-btn" data-time="17:00">17:00</div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">–í–∞—à–µ –∏–º—è:</label>
                <input type="text" class="form-input" id="name" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤">
            </div>

            <div class="form-group">
                <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                <input type="tel" class="form-input" id="phone" placeholder="+371 12345678">
            </div>

            <div class="form-group">
                <label class="form-label">–ê–≤—Ç–æ–º–æ–±–∏–ª—å:</label>
                <input type="text" class="form-input" id="car" placeholder="Toyota Camry 2018">
            </div>

            <button class="submit-btn" id="submitButton">
                <i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å
            </button>
        </div>
    </div>

    <script>
        // === –ü–†–û–°–¢–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ===
        // ‚ö†Ô∏è –í–ê–ñ–ù–û: –í–°–¢–ê–í–¨–¢–ï –°–í–û–ô –¢–û–ö–ï–ù –ò ID!
        const BOT_TOKEN = "7509122468:AAFbI7DqR_WDrtEO0qThBmox61x1ZJ6QZJw"; // –¢–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
        const CHAT_ID = "1935376446"; // –í–∞—à Telegram ID (—É–∑–Ω–∞—Ç—å —É @userinfobot)
        
        let selectedTime = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            console.log("–§–æ—Ä–º–∞ –≥–æ—Ç–æ–≤–∞!");
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—É (–∑–∞–≤—Ç—Ä–∞)
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowStr = tomorrow.toISOString().split('T')[0];
            document.getElementById('date').value = tomorrowStr;
            document.getElementById('date').min = tomorrowStr;
            
            // –í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedTime = this.dataset.time;
                    console.log("–í—ã–±—Ä–∞–Ω–æ –≤—Ä–µ–º—è:", selectedTime);
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏
            document.getElementById('submitButton').addEventListener('click', async function() {
                console.log("–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏!");
                await sendBooking();
            });
        });

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏
        async function sendBooking() {
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            const service = document.getElementById('service').value;
            const date = document.getElementById('date').value;
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const car = document.getElementById('car').value.trim();
            
            console.log("–î–∞–Ω–Ω—ã–µ:", { service, date, selectedTime, name, phone, car });
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞
            if (!service || !date || !selectedTime || !name || !phone || !car) {
                alert("‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");
                return;
            }
            
            // –ú–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫—É
            const btn = document.getElementById('submitButton');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –û—Ç–ø—Ä–∞–≤–∫–∞...';
            
            try {
                // 1. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram
                console.log("–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram...");
                const telegramSuccess = await sendToTelegram(service, date, selectedTime, name, phone, car);
                
                if (telegramSuccess) {
                    // 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Google Sheets (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
                    await sendToGoogleSheets(service, date, selectedTime, name, phone, car);
                    
                    // –£—Å–ø–µ—Ö!
                    alert("‚úÖ –ó–∞–ø–∏—Å—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!\n\n–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.");
                    
                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                    document.getElementById('name').value = '';
                    document.getElementById('phone').value = '';
                    document.getElementById('car').value = '';
                    document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('selected'));
                    selectedTime = null;
                    
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);
                    
                } else {
                    alert("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏. –ü–æ–∑–≤–æ–Ω–∏—Ç–µ –Ω–∞–º: +371 249 07171");
                }
                
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞:", error);
                alert("‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º. –ü–æ–∑–≤–æ–Ω–∏—Ç–µ: +371 249 07171");
            } finally {
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å';
            }
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
        async function sendToTelegram(service, date, time, name, phone, car) {
            try {
                const message = `üìã –ù–û–í–ê–Ø –ó–ê–ü–ò–°–¨ –ò–ó –°–ê–ô–¢–ê\n\n` +
                               `üë§ –ò–º—è: ${name}\n` +
                               `üìû –¢–µ–ª–µ—Ñ–æ–Ω: ${phone}\n` +
                               `üöó –ê–≤—Ç–æ: ${car}\n` +
                               `üõ† –£—Å–ª—É–≥–∞: ${service}\n` +
                               `üìÖ –î–∞—Ç–∞: ${date}\n` +
                               `‚è∞ –í—Ä–µ–º—è: ${time}\n` +
                               `üïê –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: ${new Date().toLocaleString()}`;
                
                console.log("–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è Telegram:", message);
                
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        text: message
                    })
                });
                
                const result = await response.json();
                console.log("–û—Ç–≤–µ—Ç Telegram:", result);
                
                return result.ok === true;
                
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ Telegram:", error);
                return false;
            }
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Google Sheets (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        async function sendToGoogleSheets(service, date, time, name, phone, car) {
            // –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å Google Apps Script, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ:
            /*
            try {
                const scriptUrl = "https://script.google.com/macros/s/–í–ê–®_ID/exec";
                const data = { service, date, time, name, phone, car };
                
                await fetch(scriptUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify(data)
                });
                
                console.log("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Google Sheets");
            } catch (error) {
                console.log("–ù–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Google Sheets (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)");
            }
            */
        }
    </script>
</body>
</html>
